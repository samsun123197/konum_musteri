<!DOCTYPE html>
<html>
<head>
    <title>Müşteri Sorgulama Ekranı</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        /* Sadece görünürlüğü artırmak için basit CSS */
        body { font-family: Arial, sans-serif; padding: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        strong { font-weight: bold; }
        #yukleniyor { color: orange; }
        .hata { color: red; }
    </style>
</head>
<body>
    <h1>Müşteri Bilgi Sorgulama</h1>
    
    <label for="musteriKodu">Müşteri Kodu Girin:</label>
    <input type="text" id="musteriKodu" placeholder="Müşteri Kodu (Örn: 12345)">
    <button onclick="sorgula()">Sorgula</button>

    <p id="yukleniyor">Veriler Google Sheets'ten yükleniyor, lütfen bekleyiniz...</p>

    <hr>

    <h2>Sonuç Ekranı</h2>
    <div id="sonucAlani"></div>

    <script>
        // Sizin sağladığınız Google Sheets CSV dışa aktarım URL'si
        const veriDosyasiURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRkONEBGWF-u3K_tU6kNvsHUpO9LUx_ZDUCvy_SCCcjWh0K7jnmGeynwM9XAUwwww/pub?output=csv';
        let tumMusteriler = [];

        // Müşterinin istediği çıktı alanları (CSV başlıklarınızla eşleşmeli!)
        const ciktiAlanlari = [
            "Müşteri Kodu", "Müşteri Adı", "Enlem", "Boylam", "Durumu", 
            "Gsm", "Kanal", "Tip", "Alt Tip", "Adres", 
            "İli", "İlçesi", "Dolap Sayısı", "Rutta mı", "Satışa Kapalımı", "Bakiye"
        ];
        
        // 1. CSV dosyasını okuma ve belleğe yükleme
        Papa.parse(veriDosyasiURL, {
            download: true,
            header: true,
            skipEmptyLines: true, // Boş satırları atla
            complete: function(results) {
                // Veri yüklenince global değişkeni doldur
                tumMusteriler = results.data;
                // Yüklenme mesajını kaldır
                document.getElementById('yukleniyor').style.display = 'none';
                document.getElementById('sonucAlani').innerHTML = 'Veriler başarıyla yüklendi. Şimdi sorgulama yapabilirsiniz.';
                
                console.log("Veri yüklendi, toplam müşteri:", tumMusteriler.length);
            },
            error: function(err, file) {
                document.getElementById('yukleniyor').innerHTML = `<p class="hata">Veri yüklenirken bir hata oluştu: ${err}</p>`;
            }
        });

        function sorgula() {
            const kodInput = document.getElementById('musteriKodu');
            const kod = kodInput.value.trim();
            const sonucDiv = document.getElementById('sonucAlani');
            
            if (kod === "") {
                sonucDiv.innerHTML = `<p class="hata">Lütfen bir Müşteri Kodu girin.</p>`;
                return;
            }

            // Arama yapmadan önce kodu temizle (gereksiz boşlukları sil)
            const arananKod = kod.toUpperCase(); // Eğer kodlar büyük/küçük harfe duyarlıysa

            sonucDiv.innerHTML = `Müşteri Kodu "${arananKod}" aranıyor...`;

            // 2. Müşteri koduna göre arama yapma
            // Not: CSV dosyanızdaki "Müşteri Kodu" sütun adının birebir eşleştiğinden emin olun.
            const musteri = tumMusteriler.find(m => String(m['Müşteri Kodu']).trim().toUpperCase() === arananKod);

            if (musteri) {
                // 3. Sonucu HTML tablo olarak ekrana yazdırma
                let html = '<table><thead><tr><th>Alan Adı</th><th>Değer</th></tr></thead><tbody>';
                
                ciktiAlanlari.forEach(alan => {
                    // Müşteri objesinde o alan varsa (başlık CSV'de var ise)
                    const deger = musteri[alan] !== undefined && musteri[alan] !== null ? musteri[alan] : '-';
                    
                    html += `<tr><td><strong>${alan}</strong></td><td>${deger}</td></tr>`;
                });

                html += '</tbody></table>';
                sonucDiv.innerHTML = html;

            } else {
                sonucDiv.innerHTML = `<p class="hata"><strong>Hata:</strong> "${arananKod}" kodlu müşteri bulunamadı. Lütfen kodu kontrol edin.</p>`;
            }
        }
    </script>
</body>
</html>
